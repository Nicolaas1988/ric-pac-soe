<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Ric Pac Soe</title>
    <script
      src="https://cdn.socket.io/4.7.2/socket.io.min.js"
      integrity="sha384-SXjv5kHka0rC+8Exi47EpvYHNs+XK8aZbZfObrEwTj5Kk3rJmPS9pWbZ2zNkk8c0"
      crossorigin="anonymous"
    ></script>
    <style>
      body {
        font-family: sans-serif;
        text-align: center;
        background-color: #f0f0f0;
      }
      #board {
        display: grid;
        grid-template-columns: repeat(8, 50px);
        grid-template-rows: repeat(8, 50px);
        gap: 5px;
        margin: 20px auto;
      }
      .cell {
        width: 50px;
        height: 50px;
        background-color: white;
        border: 1px solid #333;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 24px;
        cursor: pointer;
        user-select: none;
      }
      #controls {
        margin: 10px;
      }
      #scores {
        margin: 10px;
      }
      button {
        padding: 8px 12px;
        margin: 5px;
        cursor: pointer;
      }
    </style>
  </head>
  <body>
    <h1>Ric Pac Soe</h1>

    <div id="controls">
      <input type="text" id="playerName" placeholder="Your name" />
      <select id="symbolSelect">
        <option value="O">O (Rock)</option>
        <option value="■">■ (Paper)</option>
        <option value="X">X (Scissors)</option>
      </select>
      <button id="joinBtn">Join Game</button>
      <button id="resetBtn">Reset Game</button>
    </div>

    <div id="board"></div>

    <div id="scores">
      <h3>Scores:</h3>
      <ul id="scoreList"></ul>
    </div>

    <script>
      const socket = io()

      const boardEl = document.getElementById('board')
      const scoreListEl = document.getElementById('scoreList')
      const joinBtn = document.getElementById('joinBtn')
      const resetBtn = document.getElementById('resetBtn')
      const playerNameInput = document.getElementById('playerName')
      const symbolSelect = document.getElementById('symbolSelect')

      let playerName = ''
      let symbol = 'O'

      // Join game
      joinBtn.addEventListener('click', () => {
        playerName = playerNameInput.value.trim()
        symbol = symbolSelect.value
        if (!playerName) return alert('Enter your name!')
        socket.emit('joinGame', playerName)
      })

      // Reset game
      resetBtn.addEventListener('click', () => {
        socket.emit('resetGame')
      })

      // Render the board
      function renderBoard(board, currentPlayer) {
        boardEl.innerHTML = ''
        board.forEach((row, r) => {
          row.forEach((cell, c) => {
            const cellEl = document.createElement('div')
            cellEl.className = 'cell'
            cellEl.textContent = cell || ''
            cellEl.addEventListener('click', () => {
              if (!playerName) return alert('Join the game first!')
              if (currentPlayer === playerName && !cell) {
                socket.emit('makeMove', {
                  player: playerName,
                  row: r,
                  col: c,
                  symbol,
                })
              }
            })
            boardEl.appendChild(cellEl)
          })
        })
      }

      // Render scores
      function renderScores(scores) {
        scoreListEl.innerHTML = ''
        for (const [player, score] of Object.entries(scores)) {
          const li = document.createElement('li')
          li.textContent = `${player}: ${score}`
          scoreListEl.appendChild(li)
        }
      }

      // Listen for game state updates
      socket.on('gameState', (gameState) => {
        const currentPlayerName =
          gameState.players[gameState.currentPlayerIndex]
        renderBoard(gameState.board, currentPlayerName)
        renderScores(gameState.scores)
      })
    </script>
  </body>
</html>
